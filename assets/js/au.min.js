function sinAcentos(a) {
    for (var b = "\xc3\xc0\xc1\xc4\xc2\xc8\xc9\xcb\xca\xcc\xcd\xcf\xce\xd2\xd3\xd6\xd4\xd9\xda\xdc\xdb\xe3\xe0\xe1\xe4\xe2\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf2\xf3\xf6\xf4\xf9\xfa\xfc\xfb\xd1\xf1\xc7\xe7", c = "AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc", d = 0; d < b.length; d++) a = a.replace(b.charAt(d), c.charAt(d));
    return a
}

function normalizar(a) {
    for (var b = "\xc3\xc0\xc1\xc4\xc2\xc8\xc9\xcb\xca\xcc\xcd\xcf\xce\xd2\xd3\xd6\xd4\xd9\xda\xdc\xdb\xe3\xe0\xe1\xe4\xe2\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf2\xf3\xf6\xf4\xf9\xfa\xfc\xfb\xd1\xf1\xc7\xe7", c = "aaaaeeeeiiiioooouuuuaaaaaeeeeiiiioooouuuunncc", d = 0; d < b.length; d++) a = a.replace(b.charAt(d), c.charAt(d));
    return a.toLowerCase()
}

function normalizaSinEspacios(a) {
    for (var b = "\xc3\xc0\xc1\xc4\xc2\xc8\xc9\xcb\xca\xcc\xcd\xcf\xce\xd2\xd3\xd6\xd4\xd9\xda\xdc\xdb\xe3\xe0\xe1\xe4\xe2\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf2\xf3\xf6\xf4\xf9\xfa\xfc\xfb\xd1\xf1\xc7\xe7", c = "aaaaeeeeiiiioooouuuuaaaaaeeeeiiiioooouuuunncc", d = 0; d < b.length; d++) a = a.replace(b.charAt(d), c.charAt(d));
    return a = a.replace(/\s/g, ""), a.toLowerCase()
}

function removeOptions(a) {
    if (null != a && null != a.options)
        for (; a.options.length > 0;) a.remove(0)
}

function cargarcaps() {
    var b, a = document.getElementById("libros").value,
        c = document.getElementById("num_capitulos"),
        d = "nombre=" + a;
    b = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), b.onreadystatechange = function() {
        if (4 == b.readyState && 200 == b.status) {
            input = document.getElementById("selectores"), valor = b.responseText, removeOptions(c);
            for (var a = 1; a <= valor; a++) {
                var d = document.createElement("option");
                d.value = a, d.id = a, d.innerHTML = a, c.appendChild(d)
            }
        }
    }, b.open("GET", "welcome/cargar_capitulos" + '?' + d, !0), 
    //b.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
    b.send(d)
}

function cambio_libro(a, b, c) {
    window.location.assign("versiculo" == c ? b + normalizaSinEspacios(a) + "-1-1" : b + normalizaSinEspacios(a) + "-1")
}

function cargarCapsVers() {
    var b,
        a1 = document.getElementById("versiones").value,
        a = document.getElementById("libros").value,
        c = document.getElementById("num_capitulos"),
        d = "nombre=" + a;

    removeOptions(c),
        b = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"),
        b.onreadystatechange = function() {
            if (4 == b.readyState && 200 == b.status) {
                input = document.getElementById("selectores"), valor = b.responseText;
                for (var a = 1; a <= valor; a++) {
                    var d = document.createElement("option");
                    d.value = a, d.id = a, d.innerHTML = "Capitulo " + a, c.appendChild(d)
                }
                cargarVersos()
            }
        }, b.open("GET", "/biblia/la-biblia/"+a1+"/welcome/cargar_capitulos" + '?' + d, !0),
        //b.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
        b.send(d)
}

function PrintElem(a) {
    var b = document.getElementById("imprimible").innerHTML;
    b = stripScripts(b);
    Popup(b, a)
}

function stripScripts(s) {
    var div = document.createElement('div');
    div.innerHTML = s;
    var scripts = div.getElementsByTagName('script');
    var i = scripts.length;
    while (i--) {
      scripts[i].parentNode.removeChild(scripts[i]);
    }
    return div.innerHTML;
  }

function Popup(a, b) {
    var c = window.open("", "my div", "height=400,width=600");
    c.document.write("<!DOCTYPE html>"),
        c.document.write("<head><title>" + b + '</title><style>.titulo_versiculo{color:#3498db;font-size:1em}#right{display:none}#cap_versiculo{font-size:16px;text-align:center;margin-bottom:4px}div br{display:inline;display:none}#imprimible br{display:none}</style></head><body><img src="/assets/img/estandar/logo_imprimir.png"/>' + a + '<a href ="www.devocionalescristianos.org/biblia/">www.devocionalescristianos.org</a></body></html>'), c.document.close(), c.focus(), c.print(), c.close()
}

function consulta_cap() {
    var a = document.getElementById("libros").value,
        b = document.getElementById("versiones").value,
        c = document.getElementById("num_capitulos").value,
        d = c.replace(/^\D+/g, "");
    "Libros" != a && "" != a || "Cap\xedtulos" != d && "" != d || (a = "genesis", d = 1), ("Versiones" == b || "" == b) && (b = "Reina-valera-1960"),
        a = sinAcentos(a.replace(/\s/g, "")), window.location.assign("/biblia/la-biblia/" + b + "/" + a.toLowerCase() + "-" + d + ".php")
}


function ir_versiculo() {
    var a = document.getElementById("versiones").value,
        b = document.getElementById("libros").value,
        c = document.getElementById("num_capitulos").value,
        d = c.replace(/^\D+/g, ""),
        f = (document.getElementById("num_versiculos").value, c.replace(/^\D+/g, ""));
    "Libros" != b || "Cap\xedtulos" != d && " " != d || "Versiculos" != f && " " != d || (b = "genesis", d = 1, f = 1), ("Versiones" == a || " " == a) && (a = "Reina-valera-1960"), b = sinAcentos(b.replace(/\s/g, "")), window.location.assign("/biblia/" + a + "/" + b.toLowerCase() + "-" + d + "-" + f)
}

function cargarVersos() {
    var d, a = document.getElementById("libros").value,
        a1 = document.getElementById("versiones").value,
        b = document.getElementById("num_capitulos").value,
        c = "libro=" + a + "&capitulo=" + b,
        e = document.getElementById("num_versiculos");
    removeOptions(e), d = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), d.onreadystatechange = function() {
        if (4 == d.readyState && 200 == d.status) {
            valor = d.responseText;
            for (var a = 1; a <= valor; a++) {
                var b = document.createElement("option");
                b.value = a, b.id = a, b.innerHTML = "Versiculo " + a, e.appendChild(b)
            }
        }
    }, d.open("POST", "/biblia/la-biblia/"+a1+"/welcome/cargar_versiculos" + '?' + c, !0), 
    //d.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
    d.send(c)
}

function verificar_version() {
    var d, a = document.getElementById("versiones").value,
        b = document.getElementById("libros"),
        c = normalizar(document.getElementById("libros").value),
        e = "url=" + a + "&libro=" + c;

        window.location.assign("/biblia/la-biblia/version/" + a + ".php");

    /*d = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"),
        d.onreadystatechange = function() {
            if (4 == d.readyState && 200 == d.status) {
                valor = JSON.parse(d.response), removeOptions(b);
                for (var a in valor.libros) {
                    var c = document.createElement("option");
                    c.value = valor.libros[a].nombre, c.innerHTML = valor.libros[a].nombre, b.appendChild(c)
                }
                cargarCapsVers()
            }
        }, d.open("POST", "welcome/verificar_version" + '?' + e, !0), 
        //d.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
        d.send(e)*/
}

function cambio_version(a, b) {
    var c, d = document.getElementById("versiones").value,
        e = document.getElementById("versionRespaldo").value,
        f = normalizar(document.getElementById("libros").value),
        g = document.getElementById("num_capitulos").value,
        h = g.replace(/^\D+/g, "");
    if ("versiculo" == b) var i = document.getElementById("num_versiculos").value,
        j = i.replace(/^\D+/g, ""),
        k = "url=" + d + "&libro=" + f + "&urlAnt=" + e + "&capitulo=" + h + "&versiculo=" + j;
    else var k = "url=" + d + "&libro=" + f + "&urlAnt=" + e + "&capitulo=" + h;

    b = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), b.onreadystatechange = function() {
        if (4 == b.readyState && 200 == b.status) {
            if(b.responseText && b.responseText != "No") {
                window.location.assign("/biblia/la-biblia/" + b.responseText);
            }
        }
    }, b.open("GET", "/biblia/search.php" + '?version=' + d, !0), 
    //b.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
    b.send(d)

    //window.location.assign("/biblia/la-biblia/" + d + "/genesis-1.php");

    /*c = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"),
        c.onreadystatechange = function() {
            4 == c.readyState && 200 == c.status && (valor = JSON.parse(c.response),
                window.location.assign("igual" == valor.bool ? "capitulo" == b ? a + d + "/" + valor.libro + "-" + valor.capitulo : a + d + "/" + valor.libro + "-" + valor.capitulo + "-" + valor.versiculo : "capitulo" == b ? a + d + "/" + valor.libro + "-" + valor.capitulo : a + d + "/" + valor.libro + "-" + valor.capitulo + "-" + valor.versiculo))
        },
        c.open("POST", "peticiones_js/cambio_version", !0),
        c.setRequestHeader("Content-type", "application/x-www-form-urlencoded"),
        c.send(k)*/
}

function cambiar_capitulo(a, b, c) {
    b = b.replace(".php", '');
    var d = document.getElementById("versiones").value,
        e = normalizaSinEspacios(document.getElementById("libros").value),
        f = a,
        g = f.replace(/^\D+/g, "");
    window.location.assign("versiculo" == c ? b + d + "/" + e + "-" + g + "-1" : b + d + "/" + e + "-" + g + ".php")
}

/*Commentario*/
function cambiar_capitulo_comentario(a) {
    comentario = document.getElementById("comentario").value,
        version = document.getElementById("versiones").value,
        libro = document.getElementById("libros").value,
        window.location.assign("/bibles/comentario-biblico/?v=" + version + "&co=" + comentario + "&l=" + libro + "&cap=" + a)
}

function verificar_comentario() {
    var d, a = document.getElementById("comentario").value,
        c = (document.getElementById("libros"), normalizar(document.getElementById("libros").value)),
        e = "url=" + a + "&libro=" + c;
    d = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), d.onreadystatechange = function() {
        4 == d.readyState && 200 == d.status && (valor = JSON.parse(d.response), alert(valor))
    }, d.open("POST", "comentario/verificar_version", !0), d.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), d.send(e)
}

jQuery(function(){
    //grab URL to send request
    var url;
    jQuery(".menu.simple a").eq(1).click(function(e){
        e.preventDefault();url=jQuery(this).attr('href');
        if(!jQuery("#comments").length) {
            url = getJsonFromUrl(url);
            //add column
            jQuery("<div id=\"comments\"></div>").insertAfter(jQuery("#imprimible"));
            jQuery("#imprimible").addClass("small-6 columns");
            jQuery("#comments").addClass("small-6 columns");
            jQuery('.sidebar').hide();
            jQuery('.content').width("100%");

            //send request
            b = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), b.onreadystatechange = function() {
            if (4 == b.readyState && 200 == b.status) {
                if(b.responseText) {
                    jQuery("#comments").append(b.responseText);
                    jQuery(addCommentsSelect()).insertAfter("#close_comentario");
                        jQuery("#close_comentario").click(function(){
                        jQuery("#comments").remove();
                        jQuery("#imprimible").removeClass("small-6 columns");
                        jQuery('.sidebar').show();
                        jQuery('.content').width("820px");
                    });
                }
            }
            }, b.open("GET", "/biblia/comentario/" + url.co + "/" + url.l + "-" + url.cap + ".php", !0), 
            //b.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
            b.send("/biblia/comentario/" + url.co + "/" + url.l + "-" + url.cap + ".php")
        }
    });

    jQuery("#num_capitulos").change(function(){
        cambiar_capitulo(jQuery(this).val(),"../../la-biblia\/","capitulo")
    })

    jQuery( window ).resize(function() {
        resizeWindow();
    });

    jQuery( window ).scroll(function() {
        scroll();
    });

    scroll();
    resizeWindow();
})

function cambiar_version_comentario(query) {
    var url = jQuery(".menu.simple a").eq(1).attr('href');
    url = getJsonFromUrl(url);

    //send request
    b = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), b.onreadystatechange = function() {
    if (4 == b.readyState && 200 == b.status) {
        if(b.responseText) {
            jQuery("#comments").html(b.responseText);
            jQuery(addCommentsSelect()).insertAfter("#close_comentario");
                jQuery("#close_comentario").click(function(){
                jQuery("#comments").remove();
                jQuery("#imprimible").removeClass("small-6 columns");
                jQuery('.sidebar').show();
                jQuery('.content').width("820px");
            });
        }
    }
    }, b.open("GET", "/biblia/comentario/" + query + "/" + url.l + "-" + url.cap + ".php", !0), 
    //b.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
    b.send("/biblia/comentario/" + query + "/" + url.l + "-" + url.cap + ".php")
}

function getJsonFromUrl(query) {
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}

function resizeWindow() {
    if(jQuery( window ).height() < 350) {
        jQuery('.table_cap .sticky').css('top', 0 + 'px');
    } else if(jQuery('.table_cap .sticky').length > 0 &&jQuery('.table_cap .sticky').position().top != 100) {
        jQuery('.table_cap .sticky').css('top', 100 + 'px');
    }
}

function scroll(){
    //console.log('scroll top', jQuery( window ).scrollTop());
    if(jQuery( window ).width() < 400) {
        if(jQuery( window ).scrollTop() > 370) {
            jQuery('.table_cap .sticky').show();
        } else {
            jQuery('.table_cap .sticky').hide();
        }
    }
}

function addCommentsSelect() {
    return '<div class="small-12 columns">'
            +'<select id="comentario" onchange=\'cambiar_version_comentario(this.value)\' name="co" class="drop_versiones_comentarios">'
            +'<option value="matthew-henry">Comentario Bíblico de Matthew Henry</option>'
            +'<option value="biblia-plenitud">Comentario de la Biblia Plenitud</option>'
            +'<option value="mundo-hispano">Comentario Bíblico Mundo Hispano</option>'
            +'<option value="diario-vivir">Comentario la Biblia del Diario Vivir</option>'
            +'<option value="jamieson-fausset-brown">Comentario de Jamieson-Fausset-Brown</option>'
            +'<option value="siglo-xxi">Comentario Bíblico Siglo Veintiuno</option>'
            +'<option value="reina-valera-1995">Comentarios de la Reina Valera 1995</option>'
            +'<option value="dios-habla-hoy-1996">Notas de la Versión Dios habla Hoy</option>'
            +'<option value="kadosh">Notas de la Versión Kadosh Israelita Mesiánica</option>'
            +'<option value="biblia-textual">Notas de la Biblia Textual</option>'
            +'<option value="traduccion-nuevo-mundo">Notas de la Traducción del Nuevo Mundo</option>'
            +'<option value="biblia-americas-estudio">Notas de la Biblia de las Américas de Estudio</option>'
            +'<option value="notas-biblia-americas">Notas de la Biblia de las Américas</option>'
            +'<option value="torres-amat">Notas Torres Amat</option>'
            +'<option value="ayuda-gramatical-n-t-griego">Ayuda Gramatical para el Nuevo Testamento Griego</option>'
            +'<option value="william-barclay">Comentario de William Barclay (Nuevo Testamento)</option>'
            +'<option value="escrituras-nombre-verdadero">Comentario Escrituras del Nombre Verdadero</option>'
            +'<option value="serafin-ausejo">Serafín Ausejo (Nuevo Testamento)</option>'
            +'<option value="biblia-israel-solo-genesis">Notas Biblia de Israel - Solo Génesis</option>'
            +'<option value="santos-evangelios-scio">Scio de San Miguel (Solo los Evangelios)</option>'
            +'</select>'
            +'</div>';
}

jQuery(document).ready(function ($) {

    (function(){

        var is_reverse = ($('.sidebar ~ #main-content').length > 0);
        
        if (is_reverse) {
            var parent = $('.sidebar ~ #main-content').parent();

            var main_content = $('#main-content', parent);
            var sidebar = $('.sidebar', parent);

            main_content.append(sidebar);
        }
    })();

    (function(){

        var is_stream_item_in_content = ($('#content .main-content-row ~ .stream-item.stream-item-above-footer').length > 0);
        
        if (is_stream_item_in_content) {
            var parent = $('#content .main-content-row ~ .stream-item.stream-item-above-footer').parent();
            var stream_item = $('.stream-item.stream-item-above-footer', parent);
            parent.after(stream_item);
        }
    })();

    (function(){

        var is_footer_in_content = ($('#content .main-content-row ~ #footer').length > 0);

        if (is_footer_in_content) {
            var parent = $('#content .main-content-row ~ #footer').parent();
            var footer = $('#footer', parent);

            var stream_item_after_content = $('~ .stream-item.stream-item-above-footer', parent);

            if (stream_item_after_content.length > 0) {
                stream_item_after_content.after(footer);
            }
            else{
                parent.after(footer);
            }
        }
    })();

    (function(){
        var content_wrapper = $('#main-content>.content-wrap');
        var cuadro_wrapper = $('.content .cuadro.biblia', content_wrapper);
        var columns = $('> .columns:not(.text-center)', cuadro_wrapper);
        var is_require_center = $('> .columns:not(.text-center) .row.categorias:first-child > .columns.text-center', cuadro_wrapper).length > 0;
        if (is_require_center) {
            columns.each(function(i, column){

                var rows = $('.row.categorias:not(:first-child)', $(column));
                rows.each(function(ii, row){
                    var div = $('>div', $(row));
                    div.addClass('large-8').addClass('medium-8').addClass('small-8');
                    div.addClass('large-offset-4').addClass('medium-offset-4').addClass('small-offset-4');
                });
            });
        }
    })();

    (function(){
        $('.table_cap .sticky').css('background-color', 'white');
    })();
});